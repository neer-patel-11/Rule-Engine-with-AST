# Rule Engine with AST

## Project Overview
The Rule Engine with AST is a simple 3-tier application that determines user eligibility based on defined rules. It uses an Abstract Syntax Tree (AST) to represent conditional rules dynamically, allowing for rule creation, modification, and evaluation. 

The application includes:
- **Simple UI** for rule input and data entry
- **Backend API** that generates and evaluates rules based on ASTs
- **Data Storage** in MongoDB to persist rules and metadata

## Key Features
- **Dynamic Rule Creation**: Input rules as strings, which are parsed into an AST structure.
- **Rule Combination**: Combine multiple rules for efficient evaluation.
- **Eligibility Evaluation**: Evaluate eligibility based on rules defined in AST format.

## Architecture
The application follows :
1. **Frontend**: Basic UI for rule and data input.
2. **Backend (Node.js/Express)**: Manages the rule creation, combination, and evaluation logic.
3. **Database (MongoDB)**: Stores the AST structures and metadata.

## Design Choices
### AST Representation
The AST is represented using a Node-based structure:
- `type`: The node type, which could be "operator" (e.g., AND, OR) or "operand" (conditions like `age > 30`).
- `left` and `right`: References to child nodes.
- `value`: Stores the actual condition for operands or operator type for operator nodes.

### Database
MongoDB was chosen due to its flexibility with dynamic structures. The database stores AST nodes, and each node references its child nodes, making it efficient to query complex rules.

### Parsing and Evaluation
- **Tokenization**: A tokenization function parses rule strings into tokens.
- **AST Construction**: `ruleToNode` function generates AST nodes from parsed tokens.
- **Evaluation**: `evaluateAST` evaluates the AST nodes against provided user attributes.


## Prerequisites
- **Node.js** 
- **MongoDB**  â€“ can be run locally or in a 

## Dependencies
Install these dependencies before running the application:
```bash
    npm install express mongoose
```

## Setting Up the Application

1. Clone the Repository

```bash
    git clone https://github.com/neer-patel-11/Rule-Engine-with-AST
    
```

2. Install Node.js Dependencies

```bash
    npm install
```
3. Setup MongoDB
You can run MongoDB locally.
set up environment variables for the MongoDB connection (e.g., mongodb://localhost:27017/astDB)

4. Run the Application

```bash
    node index.js
```
The application will start on http://localhost:3000.

## API Documentation
1. ``` POST /api/rule_to_node ```
<ul>
<li><strong>Description</strong>: Creates a rule based on the input rule string and returns the AST.</li>
<li><strong>Input</strong>: <code>{ "rule": "(age &gt; 30 AND department = 'Sales') OR ..." }</code></li>
<li><strong>Output</strong>: AST representation in JSON format.</li>
</ul>
    

2. ``` POST /api/combine_rules ```
<ul>
<li><strong>Description</strong>: Combines multiple rules and returns a single combined AST.</li>
<li><strong>Input</strong>: <code>{ "rules": ["rule1", "rule2"], "operator": "AND" }</code></li>
<li><strong>Output</strong>: AST representation in JSON format.</li>
</ul>

3. ``` POST /api/evaluate ```
<ul>
<li><strong>Description</strong>: Evaluates an AST against user attributes.</li>
<li><strong>Input</strong>: <code>{ "ast": {&lt;AST_JSON&gt;}, "data": { "age": 35, "department": "Sales", "salary": 60000, "experience": 3 } }</code></li>
<li><strong>Output</strong>: <code>true</code> or <code>false</code> based on rule evaluation.</li>
</ul>

4. ``` POST /api/save_ast ```
<ul>
<li><strong>Description</strong>: Save the Rule in the form of AST in MONGODB.</li>
<li><strong>Input</strong>: <code>{ "rule": "(age &gt; 30 AND department = 'Sales') OR ..." }</code></li>
<li><strong>Output</strong>: Unique AST-ID generated by MONGODB </li>
</ul>

5. ``` GET /api/retrieve_ast/:id ```
<ul>
<li><strong>Description</strong>: Retrive AST from MONGODB in the form of JSON</li>
<li><strong>Input</strong>: AST-ID generated at the time of saving </li>
<li><strong>Output</strong>: AST representation in JSON format.</li>
</ul>
